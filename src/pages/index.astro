---
import links from '../link-items.json';

import Layout from '../layouts/Layout.astro';
import Carousel from '../components/Carousel.astro';
---

<Layout title="Welcome to Astro.">
	<main>
    <nav class="main-nav">
      <h1>Welcome to <span class="text-gradient">TeleHub.tv</span></h1>
      <div>
        <button id="open-fullscreen">
          <span class="text-gradient">Open in Fullscreen</span>
        </button>
      </div>
    </nav>

    {links.data.map(entry =>
      <Carousel title={entry.category} items={entry.items} />
    )}
	</main>
</Layout>

<style>
	main {
		margin: auto;
		padding: 1.5rem;
		max-width: 80vw;
	}

	h1 {
		font-size: 3rem;
		font-weight: 800;
		margin: 0;
	}

	.text-gradient {
		background-image: var(--accent-gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-size: 400%;
		background-position: 0%;
	}

  .main-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
</style>

<script>
  import { isFullscreen$ } from '../state';

  const teslaTelly = 'https://9016-108-6-117-33.ngrok-free.app/';
  const ytReferrerPrefix = 'https://www.youtube.com/';
  const reTeslaUserAgent =
/Tesla\/(?:develop-)*(?:feature-)*(?:.*fsd.*)*(?:factory-)*(?:terminal-)*([0-9]{4}.[0-9]{1,3}.?[0-9]{0,3}.?[0-9]{0,3}.?[0-9]{0,3})*-(.*)/g;

  const wasReferredFromYT = document.referrer.startsWith(ytReferrerPrefix);

  const openPageInFullscreen = () => {
    if (navigator.userAgent.match(reTeslaUserAgent)) {
      if (!wasReferredFromYT) {
        location.href = `${ytReferrerPrefix}redirect?q=${teslaTelly}`;
      } else {
        isFullscreen$.set(!isFullscreen$.get());
      }
    }
  }

  const fullScreenButton = document.getElementById('open-fullscreen');

  if (fullScreenButton) {
    if (wasReferredFromYT) {
      fullScreenButton.style.display = 'none';
    } else {
      fullScreenButton.addEventListener('click', openPageInFullscreen);
    }
  }

</script>
