---
import links from '../link-items.json';

import Layout from '../layouts/Layout.astro';
import Carousel from '../components/Carousel.astro';
---

<Layout title="Raphchan Life">
  <main>
    <nav class="main-nav">
      <h1>Welcome to <span class="text-gradient">TeleHub.tv</span></h1>
      <button id="open-fullscreen">
        <span class="text-gradient">Open in Fullscreen</span>
      </button>
    </nav>

    <div class="carousels">
      {links.data.map(entry =>
        <section class="carousel-wrapper">
          <Carousel title={entry.category} items={entry.items} />
        </section>
      )}
    </div>
  </main>
</Layout>

<style>
  main {
    margin: auto;
    padding: 1.5rem;
    max-width: 80vw;
    background-color: #F6F6F6;
  }

  h1 {
    font-size: 3rem;
    font-weight: 800;
    margin: 0;
  }

  .carousels {
    margin-top: 3em;
  }

  .carousel-wrapper:not(:last-child) {
    margin-bottom: 3em;
  }

  .text-gradient {
    background-image: var(--accent-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-size: 400%;
    background-position: 0%;
  }

  .main-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
</style>

<script>
  import { isFullscreen$ } from '../state';

  const teslaTelly = 'https://raphchan-life.netlify.app';
  const ytReferrerPrefix = 'https://www.youtube.com/';
  const reTeslaUserAgent =
/Tesla\/(?:develop-)*(?:feature-)*(?:.*fsd.*)*(?:factory-)*(?:terminal-)*([0-9]{4}.[0-9]{1,3}.?[0-9]{0,3}.?[0-9]{0,3}.?[0-9]{0,3})*-(.*)/g;

  const wasReferredFromYT = document.referrer.startsWith(ytReferrerPrefix);

  const openPageInFullscreen = () => {
    if (navigator.userAgent.match(reTeslaUserAgent)) {
      if (!wasReferredFromYT) {
        location.href = `${ytReferrerPrefix}redirect?q=${teslaTelly}`;
      } else {
        isFullscreen$.set(!isFullscreen$.get());
      }
    }
  }

  const fullScreenButton = document.getElementById('open-fullscreen');

  if (fullScreenButton) {
    if (wasReferredFromYT) {
      fullScreenButton.style.display = 'none';
    } else {
      fullScreenButton.addEventListener('click', openPageInFullscreen);
    }
  }

</script>
